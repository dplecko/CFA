<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Causal Fairness Analysis - Software - COMPAS - Task 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Causal Fairness Analysis - Software</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../pages/census-t1.html">
 <span class="menu-text">Census Task 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/college-admissions-t1.html">
 <span class="menu-text">College Admissions Task 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/compas-t1.html">
 <span class="menu-text">COMPAS Task 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../pages/compas-t1-extended.html" aria-current="page">
 <span class="menu-text">COMPAS Task 1 (Extended)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/compas-t2.html">
 <span class="menu-text">COMPAS Task 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/shai-challenge.html">
 <span class="menu-text">COMPAS TV/EO</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/compas-t2.html">
 <span class="menu-text">Fairadapt</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/ci-tests.html">
 <span class="menu-text">CI Tests</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#compas-under-business-necessity" id="toc-compas-under-business-necessity" class="nav-link active" data-scroll-target="#compas-under-business-necessity">COMPAS under Business Necessity</a>
  <ul class="collapse">
  <li><a href="#towards-the-solution" id="toc-towards-the-solution" class="nav-link" data-scroll-target="#towards-the-solution">Towards the solution</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">COMPAS - Task 1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this vignette, we generalize the analysis of the Fairness Cookbook, to consider more refined settings described by an arbitrary causal diagram. The main motivation for doing so comes from the observation that when analyzing disparate impact, quantities such as Ctf-DE<span class="math inline">\(_{x_0,x_1}(y\mid x_0)\)</span>, Ctf-IE<span class="math inline">\(_{x_0,x_1}(y\mid x_0)\)</span>, and Ctf-SE<span class="math inline">\(_{x_0,x_1}(y)\)</span> are insufficient to account for certain <em>business necessity</em> requirements. For concreteness, consider the following example.</p>
<section id="compas-under-business-necessity" class="level2">
<h2 class="anchored" data-anchor-id="compas-under-business-necessity">COMPAS under Business Necessity</h2>
<p>The courts at Broward County, Florida, were using machine learning to predict whether individuals released on parole are at high risk of re-offending within 2 years. The algorithm is based on the demographic information <span class="math inline">\(Z\)</span> (<span class="math inline">\(Z_1\)</span> for gender, <span class="math inline">\(Z_2\)</span> for age), race <span class="math inline">\(X\)</span> (<span class="math inline">\(x_0\)</span> denoting White, <span class="math inline">\(x_1\)</span> Non-White), juvenile offense counts <span class="math inline">\(J\)</span>, prior offense count <span class="math inline">\(P\)</span>, and degree of charge <span class="math inline">\(D\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-compas-bn" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="compas-t1-extended_files/figure-html/fig-compas-bn-1.png" class="img-fluid figure-img" width="384"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Causal diagram of the COMPAS dataset. Business Necessity variables highlighted in green.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>A causal analysis using the <code>fairness_cookbook()</code> revealed that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="fu">data</span>(<span class="st">"compas"</span>, <span class="at">package =</span> <span class="st">"faircause"</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">SFM_proj</span>(<span class="st">"compas"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>fc_compas <span class="ot">&lt;-</span> <span class="fu">fairness_cookbook</span>(data, <span class="at">X =</span> mdata<span class="sc">$</span>X, <span class="at">Z =</span> mdata<span class="sc">$</span>Z, <span class="at">W =</span> mdata<span class="sc">$</span>W,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">Y =</span> mdata<span class="sc">$</span>Y, <span class="at">x0 =</span> mdata<span class="sc">$</span>x0, <span class="at">x1 =</span> mdata<span class="sc">$</span>x1)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc_compas, <span class="at">decompose =</span> <span class="st">"xspec"</span>, <span class="at">dataset =</span> <span class="st">"COMPAS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-compas-cookbook" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="compas-t1-extended_files/figure-html/fig-compas-cookbook-1.png" class="img-fluid figure-img" width="768"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Fairness Cookbook on the COMPAS dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>That is, the computed measures equal: <span class="math display">\[
\begin{align}
  \text{Ctf-IE}_{x_1, x_0}(y\mid x_1) &amp;= -5.7\% \pm 0.5\%,\\
  \text{Ctf-SE}_{x_1, x_0}(y) &amp;= -4.0\% \pm 0.9\%,
\end{align}
\]</span> and are also shown graphically in <a href="#fig-compas-cookbook">Figure&nbsp;2</a>, potentially indicating presence of disparate impact. Based on this information, a legal team of ProPublica filed a lawsuit to the district court, claiming discrimination w.r.t. the Non-White subpopulation based on the doctrine of disparate impact. After the court hearing, the judge rules that using the attributes age (<span class="math inline">\(Z_2\)</span>), prior count (<span class="math inline">\(P\)</span>), and charge degree (<span class="math inline">\(D\)</span>) is not discriminatory, but using the attributes juvenile count (<span class="math inline">\(J\)</span>) and gender (<span class="math inline">\(Z_1\)</span>) is discriminatory. The causal diagram with a visualization of which variables are included in the business-necessity set is given in <a href="#fig-compas-bn">Figure&nbsp;1</a>. Data scientists at ProPublica need to consider how to proceed in the light of this new requirement for discounting the allowable attributes in the quantiative analysis.</p>
<p>The difficulty in this example is that the quantity Ctf-SE<span class="math inline">\(_{x_1, x_0}(y)\)</span> measures the spurious discrimination between the attribute <span class="math inline">\(X\)</span> and outcome <span class="math inline">\(Y\)</span> as generated by <em>both confounders</em> <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span>. Since using the confounder <span class="math inline">\(Z_2\)</span> is not considered discriminatory, but using the confounder <span class="math inline">\(Z_1\)</span> is, the quantity Ctf-SE<span class="math inline">\(_{x_1, x_0}(y)\)</span> needs to be refined such that the spurious variations based on the different confounders are disentangled. In particular, one might be interested in finding a decomposition of the spurious effect such that <span class="math display">\[
\begin{align}
    \text{Ctf-SE}_{x_1, x_0}(y) = \underbrace{\text{Ctf-SE}^{Z_1}_{x_1, x_0}(y)}_{\text{gender variations}} + \underbrace{\text{Ctf-SE}^{Z_2}_{x_1, x_0}(y)}_{\text{age variations}},
\end{align}
\]</span> which would allow the data analyst to further distinguish the variations explained by each of the confounders. A similar challenge is present for the Ctf-IE<span class="math inline">\(_{x_1, x_0}(y\mid x_1)\)</span> measure, since it has contributions explained by juvenile offense counts <span class="math inline">\(J\)</span>, prior counts <span class="math inline">\(P\)</span>, and the charge degree <span class="math inline">\(D\)</span>. Therefore, we might be interested in decomposing the indirect effect into <span class="math display">\[
\begin{align}
    \text{Ctf-IE}_{x_1, x_0}(y \mid x_1) =&amp; \underbrace{\text{Ctf-IE}^J_{x_1, x_0}(y \mid x_1)}_{\text{juvenile count variations}} + \underbrace{\text{Ctf-IE}^P_{x_1, x_0}(y \mid x_1)}_{\text{prior count variations}} \\ &amp;+ \underbrace{\text{Ctf-IE}^D_{x_1, x_0}(y \mid x_1)}_{\text{charge degree variations}}. \nonumber
\end{align}
\]</span> Again, such a decomposition would allow the data analyst to better understand the contribution of each of the mediators to the totality of the indirect effect. In situations when some mediating variables are in the business necessity set, while others are not, such a decomposition would allow for assessment of disparate impact claims.</p>
<section id="towards-the-solution" class="level3">
<h3 class="anchored" data-anchor-id="towards-the-solution">Towards the solution</h3>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>